<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Add Appointment - Clinic ERP</title>
  <link rel="stylesheet" href="/stylesheet/styles.css?v=2">
</head>

<body>
  <div class="container">
    <aside class="sidebar">
      <h2>ðŸ©º Clinic ERP</h2>
      <nav>
        <a href="/index">Dashboard</a>
        <a href="/patients">Patients</a>
        <a href="/appointments" class="active">Appointments</a>
        <a href="/billing">Billing</a>
        <a href="/reports">Reports</a>
        <a href="/doctor">Doctors</a>
        <a href="/settings">Settings</a>
      </nav>
    </aside>

    <main class="main">
      <header class="topbar">
        <h1><%= oldAppointment ? "Re-Appointment" : "Add Appointment" %></h1>
      </header>

      <section class="content">
        <form action="/appointments/add-appointment" method="POST" class="form">
          
          <!-- Patient -->
          <label for="patient">Patient Name:</label>
          <input type="text" id="patient" name="patient" 
            value="<%= oldAppointment ? oldAppointment.patient : '' %>" required />

          <!-- DOB -->
          <label for="dob">Date of Birth:</label>
          <input type="date" id="dob" name="dob" 
            value="<%= oldAppointment ? oldAppointment.dob.toISOString().split('T')[0] : '' %>" required />

          <!-- Gender -->
          <label for="gender">Gender:</label>
          <select id="gender" name="gender">
            <option value="Male" <%= oldAppointment?.gender === "Male" ? "selected" : "" %>>Male</option>
            <option value="Female" <%= oldAppointment?.gender === "Female" ? "selected" : "" %>>Female</option>
            <option value="Other" <%= oldAppointment?.gender === "Other" ? "selected" : "" %>>Other</option>
          </select>

          <!-- Doctor Dropdown -->
          <label for="doctor">Doctor:</label>
          <select id="doctor" name="doctor" required>
            <option value="">-- Select Doctor --</option>
            <% if (doctors && doctors.length > 0) { %>
              <% doctors.forEach((doc) => { %>
                <option value="<%= doc.name %>" 
                  <%= oldAppointment && oldAppointment.doctor === doc.name ? "selected" : "" %>>
                  <%= doc.name %> - (<%= doc.specialization %>)
                </option>
              <% }) %>
            <% } else { %>
              <option disabled>No active doctors found</option>
            <% } %>
          </select>

          <!-- Appointment Date -->
          <label for="date">Appointment Date:</label>
          <input type="date" id="date" name="date" required />

          <!-- Appointment Time -->
          <label for="time">Appointment Time:</label>
          <input type="time" id="time" name="time" required />

          <!-- Address -->
          <label for="address">Address:</label>
          <input type="text" id="address" name="address" 
            value="<%= oldAppointment ? oldAppointment.address : '' %>" required />

          <!-- Phone -->
          <label for="phone">Phone Number:</label>
          <input type="text" id="phone" name="phone" 
            value="<%= oldAppointment ? oldAppointment.phone : '' %>" required />

          <!-- Reason -->
          <label for="reason">Reason:</label>
          <input type="text" id="reason" name="reason" 
            value="<%= oldAppointment ? oldAppointment.reason : '' %>" />

          <!-- Status -->
          <label for="status">Status:</label>
          <select id="status" name="status" required>
            <option value="scheduled" <%= oldAppointment?.status === "scheduled" ? "selected" : "" %>>Scheduled</option>
            <option value="completed" <%= oldAppointment?.status === "completed" ? "selected" : "" %>>Completed</option>
            <option value="cancelled" <%= oldAppointment?.status === "cancelled" ? "selected" : "" %>>Cancelled</option>
          </select>

          <!-- Submit -->
          <button type="submit" class="btn">
            <%= oldAppointment ? "Save Re-Appointment" : "Save Appointment" %>
          </button>
        </form>
      </section>
    </main>
  </div>
</body>

</html>
