<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - Clinic ERP</title>
  <link rel="stylesheet" href="/stylesheet/styles.css?v=4">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      
      background: #f4f6f9;
      margin: 0;
    }

    .container {
      display: flex;
    }

 

    /* Main Content */
    .main {
      flex: 1;
      padding: 20px;
    }
    .topbar h1 {
      margin: 0;
      color: #333;
    }

    /* Dashboard Cards */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
    }
    .card {
      display: flex;
      flex-direction: column;
      background: white;
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    .card h3 {
      display: flex;
      align-items: center;
      color: #777;
      font-size: 1.1rem;
      margin-bottom: 12px;
    }
    .card h3 .material-symbols-outlined {
      font-size: 28px;
      margin-right: 10px;
      color: #2f80ed;
    }
    .card .value {
      font-size: 2.2rem;
      font-weight: bold;
      color: #2f3e46;
    }

    /* Date Filter + Chart */
    .content {
      background: white;
      padding: 20px;
      border-radius: 20px;
      margin-top: 40px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }
    .btn {
      background: #2f80ed;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover {
      background: #1f5bb5;
    }
    canvas {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>ðŸ©º Clinic ERP</h2>
      <nav>
        <a href="/index" class="active">Dashboard</a>
        <a href="/patients">Patients</a>
        <a href="/appointments">Appointments</a>
        <a href="/billing">Billing</a>
        <a href="/reports">Reports</a>
        <a href="/doctor">Doctors</a>
        <a href="/settings">Settings</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <header class="topbar">
        <h1>Welcome, <%= username %></h1>
      </header>

      <!-- Dashboard Cards -->
      <section class="dashboard">
        <a href="/appointments" class="card">
          <h3>
            <span class="material-symbols-outlined">calendar_today</span>
            Today's Appointments
          </h3>
          <div class="value" id="appointmentCount"><%= todayAppointments %></div>
        </a>

        <a href="/patients" class="card">
          <h3>
            <span class="material-symbols-outlined">groups</span>
            New Patients Today
          </h3>
          <div class="value" id="patientCount"><%= newPatients %></div>  <!-- âœ… dynamic -->
        </a>


        <a href="/billing" class="card">
          <h3><span class="material-symbols-outlined">payments</span>Total Revenue</h3>
          <div class="value">â‚¹<%= totalRevenue %></div>
        </a>

        <a href="/doctor" class="card">
          <h3><span class="material-symbols-outlined">person</span>Active Doctors</h3>
          <div class="value"><%= doctorsActive %></div>
        </a>

      </section>

      <!-- Date Filter + Revenue Chart -->
      <section class="content">
        <label style="font-weight:bold;">Filter by Date Range:</label><br/><br/>
        <input type="date" id="startDate" /> to 
        <input type="date" id="endDate" />
        <button class="btn" onclick="filterData()">Apply</button>

        <canvas id="revenueChart" height="120"></canvas>
      </section>
    </main>
  </div>

  <script>
    // Parse revenue data passed from server
    const revenueData = <%- revenueData %>;
    // Prepare data for Chart.js
    const labels = revenueData.map(item => item.date);
    const data = revenueData.map(item => item.revenue);

    const ctx = document.getElementById('revenueChart').getContext('2d');
    const revenueChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Revenue',
          data: data,
          borderColor: '#2f80ed',
          backgroundColor: 'rgba(47, 128, 237, 0.1)',
          fill: true,
          tension: 0.3,
          pointRadius: 5,
          pointHoverRadius: 7
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            display: true,
            position: 'top'
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Date'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Revenue (â‚¹)'
            },
            beginAtZero: true
          }
        }
      }
    });

    // Filter data based on date range
    function filterData() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      if (!startDate || !endDate) {
        alert('Please select both start and end dates.');
        return;
      }

      const filteredData = revenueData.filter(item => {
        return item.date >= startDate && item.date <= endDate;
      });

      // Update chart with filtered data
      revenueChart.data.labels = filteredData.map(item => item.date);
      revenueChart.data.datasets[0].data = filteredData.map(item => item.revenue);
      revenueChart.update();
    }
  </script>
</body>
</html>


